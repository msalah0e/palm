FROM golang:1.24-bookworm

# Install test dependencies (python3, pip, npm, node)
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-venv pipx \
    nodejs npm \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /workspace
COPY . .

# Build palm
RUN go build -ldflags "-X github.com/msalah0e/palm/cmd.version=1.0.0-test" -o /usr/local/bin/palm .

# Run tests
CMD ["sh", "/workspace/e2e/run.sh"]
